# æœ¬åœ°é…ç½®è‡ªå®šä¹‰è§„åˆ™å’Œä»£ç†ç»„
# å‰è¨€
1. æœ¬æ•™ç¨‹åªé€‚ç”¨äº [ShellClash](https://github.com/juewuy/ShellClash)
2. ä¸æ”¯æŒèŠ‚ç‚¹ç­›é€‰ï¼Œå¯ä½¿ç”¨ ShellClash è„šæœ¬é…ç½®->6->1->2 æˆ– 3 è¿›è¡Œç­›é€‰
3. è‡ªå®šä¹‰è§„åˆ™å‚è€ƒ https://github.com/Loyalsoldier/clash-rules
---
# ä¸€ã€ ShellClash é…ç½®
è¿›å…¥ ShellClash è„šæœ¬é…ç½®->6->1->4ï¼Œé€‰æ‹© 4 [Acl4SSR](https://acl4ssr-sub.github.io/) æç®€ç‰ˆï¼ˆé€‚åˆè‡ªå»ºèŠ‚ç‚¹ï¼‰  
![QQæˆªå›¾20230315130212](https://user-images.githubusercontent.com/45238096/225292060-270091da-324b-4c84-8f94-74c2fcb2dc75.png)  
ç„¶ååœ¨çº¿ç”Ÿæˆ [Clash](https://github.com/Dreamacro/clash/wiki) é…ç½®æ–‡ä»¶
# äºŒã€ é€‰æ‹©æ¨¡å¼
## 1. ç™½åå•æ¨¡å¼
æ²¡æœ‰å‘½ä¸­è§„åˆ™çš„ç½‘ç»œæµé‡ï¼Œç»Ÿç»Ÿä½¿ç”¨ä»£ç†ï¼Œé€‚ç”¨äºæœåŠ¡å™¨çº¿è·¯ç½‘ç»œè´¨é‡ç¨³å®šã€å¿«é€Ÿï¼Œä¸ç¼ºæœåŠ¡å™¨æµé‡çš„ç”¨æˆ·  
è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š
```
curl -o $clashdir/proxy-groups.yaml -L https://cdn.jsdelivr.net/gh/DustinWin/Router-Plugins@main/Local-Rules/WhiteListMode/proxy-groups.yaml
curl -o $clashdir/rules.yaml -L https://cdn.jsdelivr.net/gh/DustinWin/Router-Plugins@main/Local-Rules/WhiteListMode/rules.yaml
curl -o $clashdir/user.yaml -L https://cdn.jsdelivr.net/gh/DustinWin/Router-Plugins@main/Local-Rules/WhiteListMode/user.yaml
$clashdir/start.sh restart
```
## 2. é»‘åå•æ¨¡å¼
åªæœ‰å‘½ä¸­è§„åˆ™çš„ç½‘ç»œæµé‡ï¼Œæ‰ä½¿ç”¨ä»£ç†ï¼Œé€‚ç”¨äºæœåŠ¡å™¨çº¿è·¯ç½‘ç»œè´¨é‡ä¸ç¨³å®šæˆ–ä¸å¤Ÿå¿«ï¼Œæˆ–æœåŠ¡å™¨æµé‡ç´§ç¼ºçš„ç”¨æˆ·ã€‚é€šå¸¸ä¹Ÿæ˜¯è½¯è·¯ç”±ç”¨æˆ·ã€å®¶åº­ç½‘å…³ç”¨æˆ·çš„å¸¸ç”¨æ¨¡å¼  
è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š
```
curl -o $clashdir/proxy-groups.yaml -L https://cdn.jsdelivr.net/gh/DustinWin/Router-Plugins@main/Local-Rules/BlackListMode/proxy-groups.yaml
curl -o $clashdir/rules.yaml -L https://cdn.jsdelivr.net/gh/DustinWin/Router-Plugins@main/Local-Rules/BlackListMode/rules.yaml
curl -o $clashdir/user.yaml -L https://cdn.jsdelivr.net/gh/DustinWin/Router-Plugins@main/Local-Rules/BlackListMode/user.yaml
$clashdir/start.sh restart
```
# ä¸‰ã€ ä¿®æ”¹è§„åˆ™æˆ–ä»£ç†ç»„
## 1. è¿›å…¥ ShellClash å®‰è£…ç›®å½•
é€šè¿‡ [WinSCP](https://winscp.net/eng/downloads.php) è¿›å…¥ ShellClash å®‰è£…ç›®å½•ï¼Œå¦‚ */data/clash* æˆ– */etc/clash*
## 2. ç¼–è¾‘.yaml æ–‡ä»¶
å³å‡»ç¬¬äºŒæ­¥ä¸­å‘½ä»¤é‡Œçš„ 3 ä¸ª.yaml æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼Œä¿®æ”¹åä¿å­˜  
ä¸¾ä¾‹ï¼šæˆ‘æƒ³æ·»åŠ ä¸€ä¸ªè§„åˆ™ï¼Œé’ˆå¯¹ [Speedtest](https://www.speedtest.net/zh-Hans) ç½‘ç«™ï¼Œèƒ½å¤Ÿåˆ†åˆ«æµ‹è¯•ç›´è¿ç½‘é€Ÿå’Œä»£ç†ç½‘é€Ÿ  
é¦–å…ˆé€šè¿‡[åˆ†æµè§„åˆ™](https://github.com/blackmatrix7/ios_rule_script/tree/master/rule/Clash)æ‰¾åˆ° Speedtest ç½‘ç«™çš„æ‰€æœ‰åŸŸåæˆ– IP æ®µï¼Œç„¶åå¼€å§‹ä¿®æ”¹  
æ³¨ï¼š
- 1. **ä¸€å®šè¦ä¿è¯ç¼©è¿›å¯¹é½ï¼ä¸€å®šè¦ä¿è¯ç¼©è¿›å¯¹é½ï¼ä¸€å®šè¦ä¿è¯ç¼©è¿›å¯¹é½ï¼**
- 2. ä»¥ä¸‹åªæ˜¯èŠ‚é€‰ï¼Œè¯·é…Œæƒ…å¥—ç”¨
- 3. æ¨èä½¿ç”¨ [VSCode ç¼–è¾‘å™¨](https://code.visualstudio.com/Download) æˆ–å…¶å®ƒä¸“ä¸šæ–‡æœ¬ç¼–è¾‘å™¨
- 4. ç¡®ä¿ WinSCP å’Œç¼–è¾‘å™¨çš„æ–‡æœ¬ç¼–ç æ ¼å¼ä¸º UTF-8

â‘  ä¿®æ”¹ user.yaml æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š
```
speedtest:
  type: http
  behavior: classical
  url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Speedtest/Speedtest.yaml"
  path: ./ruleset/speedtest.yaml
  interval: 86400
```
â‘¡ ä¿®æ”¹ proxy-groups.yaml æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š
```
- name: ğŸ“ˆ ç½‘ç»œæµ‹é€Ÿ
  type: select
  proxies:
    # æµ‹è¯•ç›´è¿ç½‘é€Ÿ
    - ğŸ¯ å…¨çƒç›´è¿
    # æµ‹è¯•ä»£ç†ç½‘é€Ÿ
    - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
```
â‘¢ ä¿®æ”¹ rules.yaml æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š  
- æ³¨ï¼šåæ·»åŠ çš„è§„åˆ™æœ€å¥½æ”¾åœ¨æœ€å‰é¢

```
- RULE-SET,speedtest,ğŸ“ˆ ç½‘ç»œæµ‹é€Ÿ
```
# å››ã€ æ·»åŠ å°è§„åˆ™
ä»…æ·»åŠ ç‰¹å®šç½‘ç«™èµ°ç›´è¿æˆ–èµ°ä»£ç†ï¼Œè¿æ¥ SSH åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š
```
vi $clashdir/rules.yaml
```
æŒ‰ä¸€ä¸‹ Ins é”®ï¼ˆInsert é”®ï¼‰ï¼Œåœ¨**æœ€ä¸Šæ–¹**ç²˜è´´å¦‚ä¸‹å†…å®¹ï¼š  
æ³¨ï¼š
- 1. ä»¥ä¸‹å†…å®¹åªæ˜¯ä¸¾ä¾‹ï¼Œè¯·æ ¹æ®è‡ªèº«éœ€è¦è¿›è¡Œå¢åˆ æ”¹
- 2. å…¶å®ƒè§„åˆ™è¯·å‚è€ƒ [Clash æ–‡æ¡£](https://docs.cfw.lbyczf.com/contents/ui/profiles/rules.html) 

```
# ä»¥ googleapis.cn ä¸ºåç¼€çš„æ‰€æœ‰åŸŸåèµ°ä»£ç†
- DOMAIN-SUFFIX,googleapis.cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

# ä»¥ bilibili.com ä¸ºåç¼€çš„æ‰€æœ‰åŸŸåèµ°ç›´è¿
- DOMAIN-SUFFIX,bilibili.com,DIRECT

# å«æœ‰ github å…³é”®å­—çš„æ‰€æœ‰åŸŸåèµ°ä»£ç†
- DOMAIN-KEYWORD,github,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

# å«æœ‰ ipv6 å…³é”®å­—çš„æ‰€æœ‰åŸŸåèµ°ç›´è¿
- DOMAIN-KEYWORD,ipv6,DIRECT

# ä»¥ 13.246.108 å¼€å¤´çš„æ‰€æœ‰ IP åœ°å€èµ°ä»£ç†ï¼Œä¸”è¿›è¡Œ DNS è§£æ
- IP-CIDR,13.246.108.0/22,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

# ä»¥ 192.168.1 å¼€å¤´çš„æ‰€æœ‰ IP åœ°å€èµ°ç›´è¿ï¼Œä¸”ä¸è¿›è¡Œ DNS è§£æ
- IP-CIDR,192.168.1.0/24,DIRECT,no-resolve
```
æŒ‰ä¸€ä¸‹ Esc é”®ï¼ˆé€€å‡ºé”®ï¼‰ï¼Œè¾“å…¥è‹±æ–‡å†’å·â€œ:â€ï¼Œç»§ç»­è¾“å…¥â€œwqâ€å¹¶å›è½¦
# äº”ã€ ä½¿è§„åˆ™æˆ–ä»£ç†ç»„ç”Ÿæ•ˆ
**åˆ é™¤ config.yaml æ–‡ä»¶**ï¼Œé‡æ–°åœ¨çº¿ç”Ÿæˆ Clash é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨ Clash æœåŠ¡å³å¯
